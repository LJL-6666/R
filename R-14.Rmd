---
title: "R-14"
author: "程茜"
date: "10/3/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 2. 两变量作图
###（1）如何切分画板。
     在介绍具体的图形前，需要提醒一下，两变量其实就是两个单变量结合在一起，因此理论上可以将两个变量各放一张图，然后摆在一起对着看，怎么让两幅图甚至多幅图摆在一起看呢？这就要用到切分画板功能，即使用par(mfrow=c(a,b))函数将画图的屏幕切分成a行b列个小格子，然后每画一幅图就放在画图板的一个小格子里，整齐划一。
#### 1）定性变量及定量变量。
    先来探讨如何表现定性变量与定量变量的关系。探索定性变量与定量变量之间的关系是数据分析中很常见的需求，比如比较不同教育水平的收入差异，比较不同地段的房价差异，比较在电视剧里是好人活的集数多还是坏人活的集数多，这些就是在某个分类变量的标准下，比较另一个定量变量的表现。
    要达到这个目的的方法有很多，这里特别推荐一种图：分组箱线图，一种好用且直观的工具，能够一目了然地看清两组数据的对比及各自的分布。
```{r}
novel = read.csv("/Users/chengqian/Desktop/novel.csv", fileEncoding = "UTF-8")
head(novel)
```
    
```{r}
### 两个变量 ###
par(family='STKaiti')# 改字体, 否则不显示中文<br>#下方代码是示例（Mac）
## 定性与定量变量--分组箱线图 ##
# 将画板分成1行2列
par(mfrow = c(1, 2))    
# 不同性质的小说总点击数和评论数有差别吗
boxplot(log(总点击数) ~ 小说性质, data = novel, col = rainbow(2, alpha = 0.3), ylab = "总点击数对数")
boxplot(log(评论数) ~ 小说性质, data = novel, col = rainbow(2, alpha = 0.3), ylab = "总评论数对数")
```
    
   从图中平均看来，每篇VIP作品无论是总点击数还是总评论数都显著比公众作品更多。  
   画分组箱线图的R语言命令是boxplot()，参数可以用“公式形式”表示，即boxplot(y~x)，其中y是要对比的定量变量，x是分组变量。这表示将y按照x分组，分别画箱线图 。
   
#### 2）两个定量变量。
    如果想探究两个定量变量之间的关系，最常用的就是散点图了，它为我们观察这两变量的相关方向及相关程度提供了直观的阐释。经常在教科书中用来解释相关性的就是散点图。
    实现散点图命令是plot(x,y)，后面可以加设很多有趣的参数来丰富它，比如为图添加标题的main，在图上添加文本的text，设置坐标轴的xlab，ylab等，还可以用col来设置点的颜色，pch设定点的形状，cex设定符号的大小等。
    举例来说，比如想看看小说的总点击数和评论数有何关联，便可以画出散点图（为显示清晰，这里选取总评论数在8000以下且总点击数在20w以下的小说数据做示范）。
```{r}
# 将画板恢复
par(mfrow = c(1, 1))    
par(family='STKaiti')# 改字体, 否则不显示中文<br>#下方代码是示例（Mac）
## 两个定量变量--散点图 ##
# 去除较大的异常值后画图
test = novel[novel$评论数 < 8000 & novel$总点击数 < 200000, ]
x = test$总点击数
y = test$评论数
plot(x, y, pch = 1, cex = 0.6, xlab = "总点击数", ylab = "评论数")
```
    
   从这幅图中模模糊糊可以看出一点正相关的迹象，但相关程度并不高。遇到这种情况，可以考虑把某个连续变量离散化，也就是把它分组，变成定性变量，比如这里将总点击数离散化，再与评论数做箱线图，这时相关关系就更加明显了。 
```{r}
# 分组做分组箱线图
par(family='STKaiti')# 改字体, 否则不显示中文<br>#下方代码是示例（Mac）
aa = cut(x, breaks = c(0, 50000, 100000, 150000, 200000), labels = c("(0-5w]", "(5w-10w]", "(10w-15w]", "(15w-20w]"))
boxplot(y ~ aa, col = rainbow(4, alpha = 0.4), xlab = "总点击数", ylab = "评论数")
```
   
  当然，实践中除了想看两个变量的相关图，可能还想同时看很多变量的相关图，那是不是需要提取出两两变量分别画图呢？当然不用， plot()函数早就想好了这一点，plot(data.frame)就可以输出一个散点图矩阵，每个元素都对应着数据框中每两列对应的散点图，这样就可以一次性观察所有变量的相关关系了。
```{r}
# 散点图矩阵
plot(iris[, 1:4])
```
  
#### 3）两个定性变量。
     定性变量可以用柱状图来表示各个水平的取值，而两个定性变量则可采用柱状图的变形——堆积柱状图和并列（分组）柱状图来表现。此处仍采用小说数据做示范，选择包含2个水平的变量“小说性质”以及包含4个水平的变量“小说类别”作图 。画这种柱状图仍然采用barplot()函数，简单点说，只需要在其中添加参数beside，设为T就画出并列柱状图，设为F就画出堆积柱状图，所以图3-14中的两幅图看起来不同，其实在程序上只不过一个参数的差异。然而真正需要注意的是：画这样的图，需要输入给barplot()的数据格式是什么呢？前面介绍柱状图时已经讲到，画单变量柱状图需要输入一个向量，或者类似向量的数据（比如之前用table()函数生成的table类数据），总之就是让R知道每个柱子的高度就行。而如果画堆积或者并列柱状图，又该输入什么格式呢？两个向量？或者一个矩阵？通常会使用矩阵来生成复合柱状图。
     
```{r}
head(novel)
```
     
```{r}
data <- data.frame(a=c(34,339),b=c(45,404),c=c(188,370),d=c(18,149))
names(data) <- c("都市类小说","幻想类小说","其他","武侠类小说")
data
rownames(data) <- c("VIP作品", "大众作品")
data <- as.matrix(data)
data
```
     
```{r}
par(family='STKaiti')# 改字体, 否则不显示中文<br>#下方代码是示例（Mac）
barplot(data, beside = F, col = rainbow(2, alpha = 0.3))
legend("topright", legend = c("VIP作品", "大众作品"),
       fill = rainbow(2, alpha = 0.3), cex = 0.8)
```


```{r}
par(family='STKaiti')# 改字体, 否则不显示中文<br>#下方代码是示例（Mac）
barplot(data, beside = T, col = rainbow(2, alpha = 0.3))
legend("topright", legend = c("VIP作品", "大众作品"),
       fill = rainbow(2, alpha = 0.3), cex = 0.8)
```
















