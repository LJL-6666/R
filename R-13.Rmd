---
title: "R-13"
author: "程茜"
date: "10/3/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

    如何画基本统计图形，即对数据的描述分析。描述分析在整个数据分析过程中占据着重要地位，建模前，它是观察数据、发现问题、识别异常与规律的有力武器；建模后，它是总结规律、表现结论、传递信息的生动方式。因此了解和学习基本的作图方法，无疑会对我们的数据分析大有裨益。
    统计的基本图表并不多，简单来说，柱箱点、折直饼就是我们最常用的图表类型，具体有柱状图、箱线图、散点图、折线图、直方图和饼图。它们是针对不同变量类型、不同变量个数展现时可能用到的工具。所谓“工具为用途而生”，用好工具，首先要知道为谁画图，简单来说，问自己两个问题：（1）描述一个变量还是两个变量（多个变量展示通常都是前面基础图的组合，不恰当地使用立体图可能在表面酷炫之下使信息传达失真）？（2）描述的变量是什么类型，即定性变量还是定量变量？回答了这两个问题，就可以参考下面的介绍来选用图形了。接下来介绍各种图使用的场景及其R语言实现 。

首先读入novel.csv数据
```{r}
novel = read.csv("/Users/chengqian/Desktop/novel.csv", fileEncoding = "UTF-8")
head(novel)
```

## 1. 单变量作图
### （1）一个定性变量。
   所谓定性变量，就是性别、国籍这类描述一个事物质的特性的变量，其取值只能是离散的，比如男、女，中国、英国等。描述该类型变量的图形有两种：柱状图和饼图。
#### 1）柱状图。
    柱状图适合展示一个定性变量的频数分布，也可用来观察不同类别样本的分布。R中主要采用barplot()函数完成，它的使用方式是barplot(height,names.arg)，其中height是柱子的高度，names.arg是柱子的名称。例如在小说数据中，小说类型就是一个有不同取值的定性变量，如果想看数据中排名前五的小说类型的频数分布，便可以画一个柱状图。
```{r}
### 单变量 ###
par(family='STKaiti')# 改字体, 否则不显示中文<br>#下方代码是示例（Mac）
## 定性变量--柱状图 ##
a = table(novel$小说类型)
a = a[order(a, decreasing = T)]
barplot(a[1:5], names.arg = names(a)[1:5], col = rainbow(5, alpha = 0.4), xlab = "小说类型", ylab="频数")
```
   barplot()函数的基本参数只需要每个类别的数量，也就是说定义不同柱子高度的向量，后面的常用参数包括names.arg可定义每个柱子的名字，即分类变量的类别名称，col可以用来定义柱子的颜色，main可以用来定义图标题，等等。需要特别提醒的是：在定义颜色时采用了rainbow()函数，它可以生成漂亮的彩虹色，还可以通过alpha参数来调节透明度，让显示出来的颜色不那么突兀。
   
   2）饼图。柱状图能用“高度”展现每个类别的数量多少，那还有没有其他展现数量对比的手段呢？有，饼图就是另外一个常用选择。
在R中画饼图的核心函数是pie()，其使用方法是pie(numerical vector, labels)，也就是要传入画饼图的数字向量（也就是各类别的频数）以及每块小饼的标签，其他诸如定义颜色、标题等的参数与barplot()用法相同。简单来说，任意定义一个数值向量，就可以马上为它画张饼，

    
```{r}
## 定性变量--饼图 ##
par(family='STKaiti')# 改字体, 否则不显示中文<br>#下方代码是示例（Mac）
pie(c(4000, 3000, 2000, 1000), labels = c("北京", "天津", "上海", "广州"), main = "熊粉成员分布", col = 2:5)
```

    下面结合小说数据，来看看如何让饼图美起来。这里我们新生成一列“小说类别”的变量来辅助说明。
```{r}
par(family='STKaiti')# 改字体, 否则不显示中文<br>#下方代码是示例（Mac）
# 将小说类型进行简要合并
novel$'小说类别' = "其他"
novel$'小说类别'[novel$小说类型 == "都市小说" | novel$小说类型 == "职场小说"] = "都市类小说"
novel$'小说类别'[novel$小说类型 == "科幻小说" | novel$小说类型 == "玄幻小说" | novel$小说类型 == "奇幻小说"] = "幻想类小说"
novel$'小说类别'[novel$小说类型 == "武侠小说" | novel$小说类型 == "仙侠小说"] = "武侠类小说"
# 求出每一类所占百分比
ratio = table(novel$'小说类别') / sum(table(novel$'小说类别')) * 100
# 定义标签
label1 = names(ratio)
label2 = paste0(round(ratio, 2), "%")
# 画饼图
pie(ratio, col = heat.colors(5, alpha = 0.4), labels = paste(label1, label2, sep = "\n"), font = 1)
```
    
   这里展示了画饼图所需要的常用技巧：合并小类，计算百分比以及如何展示各块饼的标签。另外，此处特别推荐另一组颜色设置函数：heat.colors()，它类似于前面讲到的rainbow()，是一套“配色模板”。heat.colors()可以产生类红色的一组邻近色，很适合在渐变色的场景中，而且同样可以设置透明度。
   
  （2）单个定量变量。所谓定量变量，就是可以取连续数值的变量，比如年龄，收入等。常见的变量取值可以是不同对象在该变量上的取值，即横截面数据，如电视剧《人民的名义》里所有男演员的身高；也可以是一个变量在不同时期的取值，即时间序列数据，比如主角侯亮平在不同时期的收入变化。针对这两种变量，有哪些合适的图来描述呢？
1）直方图。对于横截面数据来说，最重要的可能就是它的分布了。分布这个概念在统计学中再重要不过，直方图能够直观地展现数据的分布形态及异常值，是清洗和描述数据的小帮手 。
R语言中画直方图的命令是hist()，直接使用hist(x)可以简单地画出变量x的直方图。当然，如果想展示更全面的信息，就需要设置hist()里面的其他参数，比如xlab可以用来设置直方图的横坐标题目，ylab可以用来设置直方图的纵坐标题目，breaks可用来设置直方图的组数或分割点。熟悉统计学的读者应该知道，设定不同的组数能够展示数据的不同细节，比如将小说字数这个变量取对数后做不同的分组，
```{r}
par(family='STKaiti')# 改字体, 否则不显示中文<br>#下方代码是示例（Mac）
## 定量变量--直方图 ##
novel$总字数 = novel$总字数 / 10000
par(mfrow = c(1, 2))
chara = sort(novel$总字数)[1:1500]  # 去掉异常值
hist(chara, breaks = 10, xlab = "总字数(万字)", ylab = "频数", main = "", col = "lightblue")
hist(chara, breaks = 100, xlab = "总字数(万字)", ylab = "频数", main = "", col = "lightblue")
```
 
 2）折线图。针对时间序列数据，通常想观察的是该指标随时间变化的趋势，那么折线图就是可以帮助“观趋势看走向”的有效工具。
在R中画折线图很简单，如果数据已经是R中的某种数据格式（比如tz），那么直接采用plot(x)即可
```{r}
## 定量变量--折线图 ##
par(mfrow = c(1, 1))
# 画时间序列图
data(AirPassengers)
head(AirPassengers)
##  [1] 112 118 132 129 121 135
class(AirPassengers)
##  [1] "ts"
plot(AirPassengers)
# 人民的名义百度搜索指数图
# install.packages(zoo)
library(zoo)
```
  
而如果拿到的数据仅仅是一个普通向量，又该如何将其变成可用于画图及后续时间序列分析的数据格式呢？如果数据是年、月或者季度数据，可以采用tz()函数直接加以转化；如果数据是天数据或者不等间隔的时序数据，可以选择另外一个包zoo来生成。下面以电视剧《人民的名义》的百度搜索指数为例示范后一种情况。
首先，生成时间序列数据仅需两步：①设定好时间标签（如例中的date）；②使用zoo()函数将时间标签及对应的数据“组合”在一起。将数据改为时间序列格式后，直接采用plot()函数即可画出折线图
```{r}
par(family='STKaiti')# 改字体, 否则不显示中文<br>#下方代码是示例（Mac）
# 将搜索指数index变成时间序列格式
index = c(127910, 395976, 740802, 966845, 1223419, 1465722, 1931489, 2514324, 3024847, 3174056, 3208696, 3644736, 4198117, 3868350, 3576440, 3524784, 3621275, 3695967, 3728965, 3845193, 3525579, 3452680, 3535350, 3655541, 3884779, 3780629) / 10000
date = seq(as.Date("2017-3-28"), length = 26, by = "day")
people_index = zoo(index, date)
class(people_index)
##  [1] "zoo"
plot(people_index, xlab = "时间", ylab = "百度搜索指数（万）", main = "《人民的名义》搜索指数折线图")
```
   
  如果对横轴显示时间的格式不满意，还可以通过axis()函数中的tick和label_name参数来自定义标签，其中tick用来确定横轴标记（即小竖线）的位置，label_name用来设定显示的标签
```{r}
par(family='STKaiti')# 改字体, 否则不显示中文<br>#下方代码是示例（Mac）
# 更改坐标轴显示内容
plot(people_index, xaxt = "n", xlab = "时间", ylab = "百度搜索指数（万）", main = "《人民的名义》搜索指数折线图")
times = date #or directly times = x.Date
ticks = seq(times[1], times[length(times)], by = "weeks")  # month, weeks, year etc.
label_name = c("3月28日", "4月4日", "4月11日", "4月18日")
axis(1, at = ticks, labels = label_name, tcl = -0.3)
```
  
    
    
    
    
    